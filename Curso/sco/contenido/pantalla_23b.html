<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Language" content="es" />
    <meta http-equiv="Expires" content="0" />
    <meta http-equiv="Last-Modified" content="0" />
    <meta http-equiv="Cache-Control" content="no-cache, mustrevalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <script src="js/jquery-2.1.1.min.js"></script>
    <script src="js/jquery-ui.min.js"></script>
    <script src="js/jquery.ui.touch-punch.min.js"></script>
    <script src="js/preloadjs-0.6.2.min.js"></script>
    <script src="js/anime.min.js"></script>
    <script src="js/Animations.js"></script>
    <script src="js/preCarga.js"></script>
    <link rel="stylesheet" href="css/Style.css" type="text/css" charset="utf-8" />
    <title>Pantalla 23b</title>
  </head>

  <body>
    <div id="contenido">
      <img id="bg" class="element" _origeny="0" _origenx="0" src="images/bg.png" />
      <img id="fondo" class="element" _origeny="0" _origenx="0" src="images/pantalla23/bg.png" />
      <img id="imagen1" class="element" _origeny="0" _origenx="0" src="images/pantalla23/img01.png" />
      <img id="imagen2" class="element" _origeny="0" _origenx="0" src="images/pantalla23/img02.png" />
      <img id="imagen3" class="element" _origeny="0" _origenx="0" src="images/pantalla23/img03.png" />
      <img id="imagen4" class="element" _origeny="0" _origenx="0" src="images/pantalla23/img04.png" />
      <img id="imagen5" class="element" _origeny="0" _origenx="0" src="images/pantalla23/img05.png" />
      <img id="imagen6" class="element" _origeny="0" _origenx="0" src="images/pantalla23/img06.png" />
      <img id="imagen7" class="element" _origeny="0" _origenx="0" src="images/pantalla23/img07.png" />

      <img id="dropF1" class="element" _origeny="0" _origenx="0" src="images/pantalla23/drop.png" />
      <img id="dropF2" class="element" _origeny="0" _origenx="0" src="images/pantalla23/drop02.png" />
      <img id="dropF3" class="element" _origeny="0" _origenx="0" src="images/pantalla23/drop03.png" />
      <div id="drop1" class="element drop" _origeny="220" _origenx="306" style="width: 155px; height: 160px"></div>
      <div id="drop2" class="element drop" _origeny="220" _origenx="517" style="width: 155px; height: 160px"></div>
      <div id="drop3" class="element drop" _origeny="240" _origenx="737" style="width: 235px; height: 115px"></div>

      <div id="drop4" class="element drop" _origeny="390" _origenx="200" style="width: 155px; height: 160px"></div>
      <div id="drop5" class="element drop" _origeny="390" _origenx="412" style="width: 155px; height: 160px"></div>
      <div id="drop6" class="element drop" _origeny="390" _origenx="623" style="width: 155px; height: 160px"></div>
      <div id="drop7" class="element drop" _origeny="410" _origenx="843" style="width: 235px; height: 115px"></div>

      <img id="pieza8" class="element drag" _origeny="640" _origenx="580" src="images/pantalla23/drag08.png" />
      <img id="pieza9" class="element drag" _origeny="650" _origenx="240" src="images/pantalla23/drag09.png" />
      <img id="pieza10" class="element drag" _origeny="620" _origenx="910" src="images/pantalla23/drag10.png" />
      <img id="pieza11" class="element drag" _origeny="590" _origenx="470" src="images/pantalla23/drag11.png" />
      <img id="pieza12" class="element drag" _origeny="590" _origenx="060" src="images/pantalla23/drag12.png" />
      <img id="pieza13" class="element drag" _origeny="600" _origenx="740" src="images/pantalla23/drag13.png" />
      <img id="pieza14" class="element drag" _origeny="580" _origenx="1020" src="images/pantalla23/drag14.png" />

      <img id="retroBien" class="element" _origeny="0" _origenx="0" src="images/pantalla23/retro_positiva.png" />
      <img id="retroBien2" class="element" _origeny="0" _origenx="0" src="images/pantalla23/retro_positiva02.png" />
      <img id="cerrar" class="element btn" _origeny="100" _origenx="860" src="images/pantalla23/btn01.png" />

      <!-- cargador -->
      <img id="cargando" class="cargando" src="images/cargando.gif" />
    </div>
  </body>
  <script>
    $(document).ready(function () {
      //-> ANIMACIONES: // default // arriba // abajo // izq // der // zoom // alejar // speedIzq // speedDer // flip // sheker1 ←..→ // sheker2 ↩︎ // sheker3 ↑..↓ // sheker4 ←→
      let F = function muestraContenido() {
        entrada($("#bg"), "default", 0);
        entrada($("#fondo"), "default", 0, 0);
        entrada($("#imagen5"), "default", 0.5, 0);
        entrada($("#imagen6"), "default", 0.5, 2);

        parent.reproducir("23_2", 0.2);
        parent.Audios["23_2"].once("end", function (e) {
          entrada($("#dropF2"), "default", 0.5, 0);
          entrada($("#dropF3"), "default", 0.5, 0);
          entrada($("#imagen7"), "default", 0.5, 0);
          entrada($("#drop1"), "default", 0.5, 0);
          entrada($("#drop2"), "default", 0.5, 0);
          entrada($("#drop3"), "default", 0.5, 0);
          entrada($("#drop4"), "default", 0.5, 0);
          entrada($("#drop5"), "default", 0.5, 0);
          entrada($("#drop6"), "default", 0.5, 0);
          entrada($("#drop7"), "default", 0.5, 0);
          entrada($("#pieza8"), "speedIzq", 0.5, 0.2);
          entrada($("#pieza9"), "speedIzq", 0.5, 0.4);
          entrada($("#pieza10"), "speedIzq", 0.5, 0.6);
          entrada($("#pieza11"), "speedIzq", 0.5, 0.8);
          entrada($("#pieza12"), "speedIzq", 0.5, 1);
          entrada($("#pieza13"), "speedIzq", 0.5, 1.2);
          entrada($("#pieza14"), "speedIzq", 0.5, 1.4);
        });
      };

      ///////////////// ⭐️ Variables Actividad ⭐️ ////////////////
      var respuestas1 = [null, 8, 10, 14]; // Correctas
      var respuestas2 = [null, null, null, null, 11, 12, 13, 9]; // Correctas
      var seleccionadas1 = [null, 0, 0, 0]; // Los drops y sus piezas finales
      var seleccionadas2 = [null, null, null, null, 0, 0, 0, 0]; // Los drops y sus piezas finales
      var aprobado = false;
      var dropActivo = 0;
      var dragActivo = 0;

      ///////////////// ⭐️ Drag & Drop ⭐️ ////////////////
      $(".drag").draggable({
        containment: "parent",
        cursor: "grabbing",
        revert: "invalid", // cuando no haga drop, el elemento volverá a su posición inicial
      });

      $(".drop").droppable({
        tolerance: "intersect",
        accept: ".drag",
        drop: function () {
          dropActivo = parseInt($(this).attr("id").substr(4, 2));
          console.log("Drop " + dropActivo);
          console.log("Drag " + dragActivo);
          checkMatch();
        },
      });

      ///////////////// ⭐️ Anima las piezas ⭐️ ////////////////
      $(".drag").mouseup(function () {
        dragActivo = parseInt($(this).attr("id").substr(5, 2));
      });

      ///////////////// ⭐️ Función para copiar al portapapeles ⭐️ ////////////////
      function copiarAlPortapapeles(texto) {
        var tempElement = $("<textarea>");
        $("body").append(tempElement);
        tempElement.val(texto).select();
        document.execCommand("copy");
        tempElement.remove();
        console.log("Texto copiado al portapapeles: " + texto);
      }

      $(".drag").click(function () {
        var top = $(this).css("top").replace("px", "");
        var left = $(this).css("left").replace("px", "");
        var textoCoordenadas = `_origeny="${top}" _origenx="${left}"`;
        copiarAlPortapapeles(textoCoordenadas);
      });

      ///////////////// ⭐️ Anima las piezas y verifica respuestas ⭐️ ////////////////
      function checkMatch() {
        if (dropActivo >= 1 && dropActivo <= 3) {
          seleccionadas1[dropActivo] = dragActivo;
          console.log("seleccionadas1", seleccionadas1);
          $("#pieza" + dragActivo).animate({
            top: parseInt($("#drop" + dropActivo).attr("_origeny")) + 5,
            left: parseInt($("#drop" + dropActivo).attr("_origenx")) + 5,
          });
        } else {
          seleccionadas2[dropActivo] = dragActivo;
          console.log("seleccionadas2", seleccionadas2);
          $("#pieza" + dragActivo).animate({
            top: parseInt($("#drop" + dropActivo).attr("_origeny")) + 5,
            left: parseInt($("#drop" + dropActivo).attr("_origenx")) + 5,
          });
        }

        // Verifica si ambos arrays están completos
        if (seleccionadas1.indexOf(0) == -1 && seleccionadas2.indexOf(0) == -1) {
          validar();
        }
      }

      ///////////////// ⭐️ Validar ambas respuestas ⭐️ ////////////////
      function validar() {
        console.log("%c " + JSON.stringify(respuestas1), "font-size: 100%; color: #00AEFF; font-weight: 700;");
        console.log("%c " + JSON.stringify(respuestas2), "font-size: 100%; color: #00AEFF; font-weight: 700;");
        console.log("%c " + JSON.stringify(seleccionadas1), "font-size: 100%; color: #00AEFF; font-weight: 700;");
        console.log("%c " + JSON.stringify(seleccionadas2), "font-size: 100%; color: #00AEFF; font-weight: 700;");

        var respuestas1Validas = validarArray(respuestas1, seleccionadas1);
        var respuestas2Validas = validarArray(respuestas2, seleccionadas2);

        if (respuestas1Validas && respuestas2Validas) {
          console.log("%c Bien", "font-size: 100%; color: #00ff22; font-weight: 700;");
          parent.enviarEnfrente();
          entrada($("#retroBien2"), "default", 0.5, 0.2);
          entrada($("#cerrar"), "default", 0.5, 0.5);
          terminarPantalla();
        } else {
          console.log("%c Mal", "font-size: 100%; color: #ff001e; font-weight: 700;");
          resetSeleccionadas();
        }
      }

      function validarArray(respuestas, seleccionadas) {
        var valoresFijos = [respuestas[respuestas.length - 1]];
        var valoresOrdenLibre = respuestas.slice(1, respuestas.length - 1);
        var seleccionadosFijos = [seleccionadas[seleccionadas.length - 1]];
        var seleccionadosOrdenLibre = seleccionadas.slice(1, seleccionadas.length - 1);

        return JSON.stringify(valoresFijos) === JSON.stringify(seleccionadosFijos) && arraysIgualesSinOrden(valoresOrdenLibre, seleccionadosOrdenLibre);
      }

      function resetSeleccionadas() {
        seleccionadas1 = [null, 0, 0, 0];
        seleccionadas2 = [null, null, null, null, 0, 0, 0, 0];
        dropActivo = 0;
        dragActivo = 0;
        aprobado = false;
        for (let i = 1; i <= 20; i++) {
          $("#pieza" + i).animate({
            top: parseInt($("#pieza" + i).attr("_origeny")),
            left: parseInt($("#pieza" + i).attr("_origenx")),
          });
        }
      }

      function arraysIgualesSinOrden(arr1, arr2) {
        return arr1.sort().toString() === arr2.sort().toString();
      }

      $("#cerrar").click(function () {
        parent.nextPage();
      });

      preload(document.title, F);
    }); //ready
  </script>
</html>
